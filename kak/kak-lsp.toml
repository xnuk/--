verbosity = 2
snippet_support = true

[server]
timeout = 1800

[semantic_tokens]
faces = [
	{face='documentation', token='comment', modifiers=['documentation']},
	{face='comment', token='comment'},
	{face='function', token='function'},
	{face='keyword', token='keyword'},
	{face='module', token='namespace'},
	{face='operator', token='operator'},
	{face='string', token='string'},
	{face='type', token='type'},
	{face='default+d', token='variable', modifiers=['readonly']},
	{face='default+d', token='variable', modifiers=['constant']},
	{face='variable', token='variable'},
]

[language.tsx]
filetypes = ['typescript', 'javascript']
roots = ['deno.json', '.git']
command = 'sh'
args = ['-c', '''
set -euf

top=''
tt='ts'

for _ in $(seq 10); do
	if [ -f "${top}deno.json" ]; then
		tt='deno'
		break
	elif [ -f "${top}package.json" ]; then
		tt='ts'
		break
	else
		top="../${top}"
	fi
done

if [ "$tt" = 'deno' ]; then
	exec deno lsp
else
	exec typescript-language-server --stdio
fi
''']
[language.tsx.settings.deno]
enable = true
lint = true

[language.rust]
filetypes = ['rust']
roots = ['Cargo.toml', '.git']
# command = 'sh'
# args = ['-c', '''
# if path=$(rustup which rust-analyzer 2>/dev/null); then
# 	exec "$path"
# else
# 	rust-analyzer
# fi
# ''']
command = 'rust-analyzer'
settings_section = 'rust-analyzer'
[language.rust.settings.rust-analyzer]
check.command = 'clippy'


[language.haskell]
filetypes = ['haskell']
roots = ['Setup.hs', 'stack.yaml', '*.cabal', '.git']
command = 'haskell-language-server-wrapper'
args = [ '--lsp' ]
settings_section = 'haskell'

[language.haskell.settings.haskell]
haskell.formattingProvider = 'fourmolu'

[language.json]
filetypes = ['json']
roots = ['package.json']
command = 'vscode-json-languageserver'
args = ['--stdio']

[language.yaml]
filetypes = ['yaml']
roots = ['.git']
command = 'yaml-language-server'
args = ['--stdio']

[language.scss]
filetypes = ['scss']
roots = ['.git']
command = 'stylelint-lsp'
args = ['--stdio']

[language.crystal]
filetypes = ['crystal']
roots = ['.git', 'shard.yml', 'shard.yaml']
command = 'crystalline'

[language.python]
filetypes = ['python']
roots = ['requirements.txt', 'setup.py', 'setup.cfg', 'pyproject.toml', '.git']

# # try this on mypy v0.981
# command = 'pylsp'
# settings_section = '_'
# [language.python.settings._.pylsp.plugins]
# pycodestyle.enabled = true
# yapf.enabled = false
# mypy.enabled = true
# mypy.live_mode = true
# mypy.strict = true

command = 'pyright-langserver'
args = ['--stdio']

[language.java]
filetypes = ['java']
roots = ['.git', 'pom.xml']
command = 'java-language-server'

[language.toml]
filetypes = ['toml']
roots = ['.git']
command = 'taplo'
args = ['lsp', 'stdio']

[language.terraform]
filetypes = ['terraform', 'tf']
command = 'terraform-ls'
args = ['serve']
roots = ['.git']
